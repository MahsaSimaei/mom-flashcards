<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mom's Flashcards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts: Quicksand for body, Dancing Script for title -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --pink: #f8bbd0;
      --pastel-blue: #b3e0ff;
      --white: #fff;
      --baby-blue: #e3f2fd;
      --accent: #fce4ec;
      --strong-pink: #e573a8;
      --easy-green: #56c596;
      --hard-red: #f67280;
      --shadow: 0 8px 32px 0 rgba(240, 98, 146, 0.14);
      --panel-shadow: 0 8px 38px 0 rgba(179, 224, 255, 0.17);
      --border-radius: 22px;
      --big-text: 1.7rem;
      --med-text: 1.25rem;
      --side-padding: 36px;
      --max-width: 1100px;
      --gradient-main: linear-gradient(130deg, #fce4ec 55%, #e3f2fd 100%);
      --gradient-panel: linear-gradient(120deg, #b3e0ff 80%, #f8bbd0 100%);
      --gradient-card: linear-gradient(120deg, #f8bbd0 90%, #fce4ec 100%);
      --gradient-card-flip: linear-gradient(120deg, #e3f2fd 90%, #b3e0ff 100%);
      --progress-bg: #fde0ef;
      --progress-bar: #e573a8;
      --quiz-correct: #56c596;
      --quiz-wrong: #f67280;
      --quiz-neutral: #e3f2fd;
    }
    html, body {
      min-height: 100vh;
      background: var(--gradient-main);
      font-family: 'Quicksand', Arial, sans-serif;
      color: #333;
      font-size: var(--med-text);
      margin: 0;
      padding: 0;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .hero-header {
      width: 100%;
      max-width: 700px;
      margin: 48px auto 28px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: linear-gradient(110deg, #fff 85%, #f8bbd0 100%);
      border-radius: 26px;
      box-shadow: 0 8px 44px 0 rgba(248, 187, 208, 0.16);
      padding: 38px 5vw 24px 5vw;
      position: relative;
      z-index: 2;
      animation: fadeInUp 1s cubic-bezier(.23,1.07,.56,1.14);
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(64px);}
      to   { opacity: 1; transform: none;}
    }
    .hero-header h1 {
      font-size: 2.28rem;
      color: var(--strong-pink);
      font-family: 'Dancing Script', cursive, 'Quicksand', Arial, sans-serif;
      letter-spacing: 1.5px;
      font-weight: 700;
      text-shadow: 0 5px 18px #fde0ef90, 0 1px 0 #fff;
      margin: 0 0 8px 0;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3em;
      line-height: 1.15;
    }
    .hero-header .hearts {
      font-size: 1.25em;
      margin-right: 0.12em;
      text-shadow: 0 2px 8px #fde0ef88;
      display: inline-block;
    }
    .subtitle {
      font-size: 1.16rem;
      color: #4c395c;
      background: linear-gradient(90deg, #fce4ec 70%, #b3e0ff 100%);
      padding: 8px 26px;
      border-radius: 17px;
      margin-bottom: 13px;
      margin-top: 0;
      box-shadow: 0 2px 8px #f8bbd025;
      font-family: 'Quicksand', Arial, sans-serif;
      font-weight: 700;
      letter-spacing: 1px;
      position: relative;
      display: inline-block;
      animation: fadeIn 1.7s 0.4s backwards;
    }
    @keyframes fadeIn {
      from { opacity: 0;}
      to   { opacity: 1;}
    }
    .divider {
      width: 60px;
      border: 0;
      border-top: 3px solid #f8bbd0;
      margin: 18px auto 0 auto;
      opacity: 0.7;
    }
    .container {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 34px;
      width: 100%;
      max-width: var(--max-width);
      padding: 0 var(--side-padding);
      box-sizing: border-box;
    }
    .main-content {
      flex: 7;
      min-width: 0;
      max-width: 70%;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      gap: 0.5em;
      filter: drop-shadow(var(--shadow));
    }
    .side-panel {
      flex: 3;
      min-width: 250px;
      max-width: 340px;
      width: 30%;
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 1.5em;
      filter: drop-shadow(var(--panel-shadow));
    }
    #mode-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
    }
    .mode-nav-btn {
      background: var(--pastel-blue);
      color: #234;
      border: 2px solid var(--baby-blue);
      font-size: 1.09em;
      padding: 11px 19px;
      border-radius: 12px;
      font-family: 'Quicksand', Arial, sans-serif;
      cursor: pointer;
      font-weight: 700;
      outline: none;
      transition: background 0.18s, color 0.13s;
    }
    .mode-nav-btn.active,
    .mode-nav-btn:focus {
      background: var(--pink);
      color: var(--strong-pink);
      border: 2px solid var(--strong-pink);
    }
    /* FLASHCARD STYLES */
    #flashcard {
      background: var(--gradient-card);
      border-radius: var(--border-radius);
      box-shadow: 0 7px 32px 0 rgba(240, 98, 146, 0.18);
      width: 100%;
      min-height: 170px;
      max-width: 520px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 0 0 22px 0;
      padding: 38px 18px;
      font-size: var(--big-text);
      cursor: pointer;
      user-select: none;
      text-align: center;
      transition: background 0.22s, color 0.18s, box-shadow 0.2s, opacity 0.27s;
      color: #3d405b;
      border: 2px solid #fff0;
      outline: none;
      opacity: 1;
      animation: cardFadeIn 0.7s;
      will-change: opacity;
    }
    #flashcard.flipped {
      background: var(--gradient-card-flip);
      color: #374151;
      border: 2px solid var(--strong-pink);
    }
    @keyframes cardFadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }
    #counter {
      font-size: 1.1em;
      color: #9a4c85;
      margin-bottom: 15px;
      font-weight: 600;
    }
    .buttons {
      display: flex;
      justify-content: flex-start;
      gap: 14px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }
    button {
      padding: 14px 26px;
      font-size: 1.1em;
      border: none;
      border-radius: 12px;
      background: var(--baby-blue);
      color: #234;
      cursor: pointer;
      font-family: 'Quicksand', Arial, sans-serif;
      font-weight: 600;
      margin: 0 1px;
      box-shadow: 0 2px 8px #f8bbd033;
      transition: background 0.18s, color 0.13s;
      outline: none;
    }
    button:focus, button:hover {
      background: var(--strong-pink);
      color: #fff;
    }
    .easy-btn {
      background: var(--easy-green);
      color: #fff;
    }
    .easy-btn:hover, .easy-btn:focus {
      background: #399b6c;
      color: #fff;
    }
    .hard-btn {
      background: var(--hard-red);
      color: #fff;
    }
    .hard-btn:hover, .hard-btn:focus {
      background: #c6425a;
    }
    .mode-btn {
      background: var(--pastel-blue);
      color: #234;
      border: 2px solid var(--baby-blue);
      margin-bottom: 0.4em;
      font-size: 1.06em;
      padding: 11px 18px;
    }
    .mode-btn.active,
    .mode-btn:focus {
      background: var(--pink);
      color: var(--strong-pink);
      border: 2px solid var(--strong-pink);
    }
    #import-area {
      width: 100%;
      max-width: 520px;
      margin: 13px 0 24px 0;
      background: #fff7faff;
      border-radius: 13px;
      box-shadow: 0 1px 12px #b3e0ff22;
      padding: 0 0 14px 0;
    }
    #import-area summary {
      cursor:pointer;
      font-size: 1.15em;
      color: var(--strong-pink);
      font-weight: 700;
      padding: 18px 22px 10px 22px;
    }
    #import {
      width: 93%;
      min-height: 95px;
      font-size: 1em;
      border-radius: 9px;
      border: 1.7px solid #bbc;
      padding: 7px;
      margin-bottom: 8px;
      margin-left: 2.5%;
      margin-right: 2.5%;
      resize: vertical;
      font-family: 'Quicksand', Arial, sans-serif;
    }
    #import-btn, #reset-btn {
      background: var(--easy-green);
      color: #fff;
      margin-left: 2.5%;
      margin-bottom: 7px;
    }
    #import-btn:hover, #import-btn:focus, #reset-btn:hover, #reset-btn:focus {
      background: #399b6c;
    }
    /* 2x2 Stats Grid for Side Panel */
    #stats {
      background: var(--gradient-panel);
      border-radius: var(--border-radius);
      box-shadow: var(--panel-shadow);
      padding: 26px 22px 22px 22px;
      width: 100%;
      min-width: 0;
      margin-bottom: 0.8em;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.2em 1.5em;
      width: 100%;
    }
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      background: rgba(255,255,255,0.13);
      border-radius: 13px;
      padding: 8px 10px 8px 12px;
      min-width: 0;
      box-sizing: border-box;
      min-height: 70px;
      box-shadow: 0 2px 8px #f8bbd01a;
    }
    .stat-item strong {
      font-size: 1.22em;
      color: var(--strong-pink);
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 3px;
    }
    .stat-label {
      font-size: 0.97em;
      font-weight: 500;
      color: #486;
    }
    .progress-bar-wrap {
      width: 100%;
      max-width: 100%;
      height: 13px;
      background: var(--progress-bg);
      border-radius: 11px;
      margin: 7px 0 0 0;
      box-shadow: 0 1px 5px #eee4;
      overflow: hidden;
      display: flex;
      align-items: center;
    }
    .progress-bar-inner {
      height: 100%;
      background: linear-gradient(90deg, var(--progress-bar), #f8bbd0 80%);
      border-radius: 11px;
      width: 0%;
      transition: width 0.7s cubic-bezier(.61,1.13,.49,.98);
    }
    /* QUIZ GAME STYLES */
    #quiz-area, #matching-area {
      background: var(--gradient-card);
      border-radius: var(--border-radius);
      box-shadow: 0 7px 32px 0 rgba(240, 98, 146, 0.14);
      padding: 38px 18px 28px 18px;
      width: 100%;
      max-width: 520px;
      margin-bottom: 18px;
      display: none;
      flex-direction: column;
      align-items: center;
    }
    #quiz-area.active, #matching-area.active {
      display: flex;
    }
    /* Quiz/matching navigation and MC styles */
    .quiz-type-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      justify-content: center;
    }
    .quiz-type-btn {
      background: var(--accent);
      color: #444;
      border: 2px solid var(--pastel-blue);
      border-radius: 10px;
      font-size: 1em;
      font-family: 'Quicksand', Arial, sans-serif;
      padding: 7px 15px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.15s, color 0.13s, border 0.13s;
    }
    .quiz-type-btn.active, .quiz-type-btn:focus {
      background: var(--pink);
      color: var(--strong-pink);
      border: 2px solid var(--strong-pink);
    }
    .quiz-mc-list {
      list-style: none;
      padding: 0;
      margin: 0 0 10px 0;
      display: flex;
      flex-direction: column;
      gap: 11px;
      width: 96%;
    }
    .quiz-mc-btn {
      background: var(--quiz-neutral);
      color: #234;
      border: 2px solid #bbc;
      border-radius: 10px;
      font-size: 1.07em;
      cursor: pointer;
      font-family: 'Quicksand', Arial, sans-serif;
      font-weight: 600;
      padding: 13px 11px;
      transition: background 0.12s, color 0.11s, border 0.11s;
    }
    .quiz-mc-btn.correct {
      background: var(--easy-green);
      color: #fff;
      border: 2px solid var(--easy-green);
    }
    .quiz-mc-btn.wrong {
      background: var(--hard-red);
      color: #fff;
      border: 2px solid var(--hard-red);
    }
    .quiz-mc-btn.disabled {
      opacity: 0.7;
      pointer-events: none;
    }
    .matching-nav {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      justify-content: center;
    }
    .matching-nav-btn {
      background: var(--accent);
      color: #444;
      border: 2px solid var(--pastel-blue);
      border-radius: 10px;
      font-size: 1em;
      font-family: 'Quicksand', Arial, sans-serif;
      padding: 7px 15px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.15s, color 0.13s, border 0.13s;
    }
    .matching-nav-btn.active, .matching-nav-btn:focus {
      background: var(--pink);
      color: var(--strong-pink);
      border: 2px solid var(--strong-pink);
    }
    /* End quiz/matching navigation and MC styles */
    /* ... rest of your CSS as above ... */
    #quiz-question {
      font-size: 1.2em;
      margin-bottom: 22px;
      color: #3d405b;
      text-align: center;
      word-break: break-word;
    }
    #quiz-input {
      padding: 10px 12px;
      font-size: 1.08em;
      border-radius: 9px;
      border: 1.5px solid #bbc;
      margin-bottom: 10px;
      width: 90%;
      font-family: 'Quicksand', Arial, sans-serif;
      background: #fff;
      color: #234;
    }
    #quiz-submit-btn {
      background: var(--pastel-blue);
      color: #234;
      margin-bottom: 7px;
    }
    #quiz-feedback {
      margin-top: 10px;
      font-weight: 700;
      font-size: 1.09em;
    }
    #quiz-feedback.correct {
      color: var(--quiz-correct);
    }
    #quiz-feedback.wrong {
      color: var(--quiz-wrong);
    }
    #quiz-progress {
      margin-top: 15px;
      font-size: 1.05em;
      color: #a47cae;
    }
    #quiz-score {
      font-size: 1.18em;
      margin: 10px 0;
    }
    .match-grid {
      display: flex;
      gap: 24px;
      width: 100%;
      justify-content: center;
      margin-bottom: 20px;
    }
    .match-col {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 47%;
    }
    .match-btn {
      background: var(--quiz-neutral);
      color: #234;
      border: 2px solid #bbc;
      border-radius: 10px;
      padding: 13px 6px;
      font-size: 1.05em;
      cursor: pointer;
      font-family: 'Quicksand', Arial, sans-serif;
      font-weight: 600;
      transition: background 0.15s, color 0.13s, border 0.13s;
    }
    .match-btn.selected {
      background: var(--strong-pink);
      color: #fff;
      border: 2px solid var(--hard-red);
    }
    .match-btn.matched {
      background: var(--easy-green);
      color: #fff;
      border: 2px solid var(--easy-green);
      cursor: default;
      opacity: 0.7;
    }
    .match-btn.incorrect {
      background: var(--hard-red);
      color: #fff;
      border: 2px solid var(--hard-red);
      animation: shakeMatch 0.4s;
    }
    @keyframes shakeMatch {
      10% { transform: translateX(-7px);}
      30% { transform: translateX(7px);}
      50% { transform: translateX(-7px);}
      80% { transform: translateX(7px);}
      100% { transform: none;}
    }
    #matching-score {
      margin-bottom: 7px;
      font-size: 1.07em;
      font-weight: 700;
      color: #a47cae;
    }
    #matching-end-message {
      font-size: 1.16em;
      font-weight: 700;
      margin-top: 12px;
    }
    @media (max-width: 700px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .stat-item {
        min-height: 60px;
      }
      #quiz-area, #matching-area {
        padding: 18px 2vw 13px 2vw;
      }
      .match-grid { flex-direction: column; gap: 16px;}
      .match-col { width: 100%;}
    }
    @media (max-width: 950px) {
      .container {
        flex-direction: column;
        gap: 0;
        padding: 0 4vw;
      }
      .main-content, .side-panel {
        max-width: 100%;
        width: 100%;
      }
      .side-panel {
        margin-top: 40px;
        align-items: flex-stretch;
      }
    }
    @media (max-width: 600px) {
      .hero-header {
        padding: 18px 2vw 13px 2vw;
      }
      .hero-header h1 {
        font-size: 1.3rem;
      }
      .subtitle {
        font-size: 0.98rem;
      }
      #flashcard {
        font-size: 1.05rem;
        padding: 16px 3vw;
      }
      .buttons button {
        font-size: 0.97em;
        padding: 8px 10px;
      }
      #import-area {
        max-width: 98vw;
      }
      #stats {
        padding: 13px 8vw 13px 8vw;
      }
    }
  </style>
</head>
<body>
  <div class="hero-header">
    <h1>
      <span class="hearts">üíñMom's Flashcardsüíñ</span>
      
    </h1>
    <div class="subtitle">Made by Mahsa</div>
    <hr class="divider">
  </div>
  <div class="container">
    <div class="main-content">
      <div id="mode-bar">
        <button id="flashcard-mode-btn" class="mode-nav-btn active">Flashcards</button>
        <button id="quiz-mode-btn" class="mode-nav-btn">Quiz</button>
        <button id="matching-mode-btn" class="mode-nav-btn">Matching Game</button>
      </div>
      <div id="lang-toggle-row" style="margin-bottom: 12px;">
        <button id="toggle-lang-btn" class="mode-btn" style="min-width:190px">
          Show English ‚Üí Spanish
        </button>
      </div>
      <div class="buttons" style="margin-bottom: 0.7em;">
        <button id="shuffle-btn" class="mode-btn">Shuffle / Random Mode</button>
      </div>
      <div class="buttons" style="margin-bottom:0.7em;">
        <button id="mode-all" class="mode-btn active">All Cards</button>
        <button id="mode-difficult" class="mode-btn">Difficult Cards</button>
      </div>
      <div id="flashcard-area">
        <div id="flashcard" tabindex="0">Click to show answer</div>
        <div id="counter"></div>
        <div class="buttons">
          <button id="prev-btn" aria-label="Previous card">&lt; Prev</button>
          <button id="flip-btn" aria-label="Flip card">Flip</button>
          <button id="next-btn" aria-label="Next card">Next &gt;</button>
        </div>
        <div class="buttons">
          <button id="easy-btn" class="easy-btn" aria-label="Mark card as Easy">Easy üëç</button>
          <button id="hard-btn" class="hard-btn" aria-label="Mark card as Difficult">Difficult üòÖ</button>
        </div>
      </div>
      <div id="quiz-area">
        <div class="quiz-type-bar">
          <button id="quiz-type-mc" class="quiz-type-btn active">Test (Multiple Choice)</button>
          <button id="quiz-type-write" class="quiz-type-btn">Write Answer</button>
        </div>
        <div id="quiz-question"></div>
        <ul id="quiz-mc-list" class="quiz-mc-list" style="display:none"></ul>
        <input id="quiz-input" type="text" autocomplete="off" placeholder="Type your answer here...">
        <button id="quiz-submit-btn">Submit</button>
        <div id="quiz-feedback"></div>
        <div id="quiz-progress"></div>
        <div id="quiz-score"></div>
        <button id="quiz-exit-btn" class="mode-btn" style="margin-top:15px;">Back to Flashcards</button>
      </div>
      <div id="matching-area">
        <div class="matching-nav">
          <button id="matching-prev" class="matching-nav-btn">&lt; Prev 8</button>
          <button id="matching-next" class="matching-nav-btn">Next 8 &gt;</button>
        </div>
        <div id="matching-score"></div>
        <div class="match-grid">
          <div class="match-col" id="match-left"></div>
          <div class="match-col" id="match-right"></div>
        </div>
        <div id="matching-end-message"></div>
        <button id="matching-exit-btn" class="mode-btn" style="margin-top:12px;">Back to Flashcards</button>
      </div>
      <details id="import-area">
        <summary>Edit or Import Cards</summary>
        <p style="font-size:1.05em;margin:8px 0 2px 0;">Paste your cards below in <strong>Front side,Back side</strong> format (one per line):</p>
        <textarea id="import" spellcheck="false" rows="8"></textarea>
        <br>
        <button id="import-btn">Import Cards</button>
        <button id="reset-btn" type="button">Reset to Default</button>
      </details>
    </div>
    <div class="side-panel">
      <div id="stats">
        <div class="stats-grid">
          <div class="stat-item">
            <strong id="stat-reviewed">0</strong>
            <span class="stat-label">Reviewed</span>
            <div class="progress-bar-wrap" title="Card Progress">
              <div class="progress-bar-inner" id="progress-reviewed"></div>
            </div>
          </div>
          <div class="stat-item">
            <strong id="stat-correct">0%</strong>
            <span class="stat-label">Accuracy</span>
            <div class="progress-bar-wrap" title="Accuracy">
              <div class="progress-bar-inner" id="progress-accuracy"></div>
            </div>
          </div>
          <div class="stat-item">
            <strong id="stat-difficult">0</strong>
            <span class="stat-label">Difficult</span>
            <div class="progress-bar-wrap" title="Difficult Cards">
              <div class="progress-bar-inner" id="progress-difficult"></div>
            </div>
          </div>
          <div class="stat-item">
            <strong id="stat-mode">All</strong>
            <span class="stat-label">Mode</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // --- STORAGE KEYS ---
    const STORAGE_KEY_CARDS = 'mom_flashcards_cards_v1';
    const STORAGE_KEY_STATS = 'mom_flashcards_stats_v1';

    // --- DEFAULT CARDS ---
    const defaultCardsText = `
the brake didn't work: ÿ™ÿ±ŸÖÿ≤ ⁄©ÿßÿ± ŸÜŸÖ€å‚Äå⁄©ÿ±ÿØ,El freno no funcion√≥
I'm running a fever,Tengo fiebre
It just came out of the oven,Acaba de salir del horno
This shirt looks good on me?,¬øMe queda bien esta camisa?
Hold on a minute!,¬°Espera un minuto!
Nephew,Sobrino
Fountain,Fuente
The brake didn't work,El freno no funcion√≥
I neither smoke nor drink,No fumo ni bebo
jacket pocket,bolsillo de la chaqueta
make friend,Hacer amiga
the closet ATM,el cajero autom√°tico del armario
zucchini,calabac√≠n
I'm heading home,voy a casa
Could you say that again please?,¬øPodr√≠as decirlo de nuevo?
I was wondering if I could borrow your notes,¬øPuedo prestar tus notas?
Could you give me a hand?,¬øPodr√≠as echarme una mano? ¬øMe puedes ayudar?
I'm sorry to hear that,Lo siento mucho
I'll let you know,Te lo avisar√©
I will call you back,Te llamar√© de nuevo
I can't hear you,No te puedo escuchar
I get off work at 6,Mi trabajo termina a las 6
I'm coming to pick you up,Estoy en camino para recogerte
Nonsense,Sin sentido
as we age,a medida que envejecemos
Sesame,S√©samo
companion,compa√±era
a small handful,un peque√±o pu√±ado
rely,confiar
miracle,milagro
had eased,se hab√≠a aliviado
soak stir and sip,remojar, remover y beber
pumpkin seeds,semillas de calabaza
resilience,resiliencia
Stillness,Quietud
embody,encarnar
Hemp seeds,semillas de c√°√±amo
sauce,salsa
sesame paste,ÿÆŸÖ€åÿ± ⁄©ŸÜÿ¨ÿØ
grace,gracia
humble way,manera humilde
manera humilde,perseguir a la juventud
dye,te√±ir
curly hair,cabello rizado, ŸÖŸà€å ŸÅÿ±ŸÅÿ±€å
follow your doctor's advice,Siga los consejos de su m√©dico
long time no see,mucho tiempo sin verlo
How's it going?,¬øC√≥mo va todo?
How have you been?,¬øC√≥mo has estado?
I think so too.,Yo tambi√©n lo creo.
I'm not sure about that.,No estoy seguro de eso.
that sounds great,Suena genial.
I'm looking forward to it.,Estoy deseando que llegue.
no worries,No te preocupes
would you like me to call him,¬øQuieres que lo llame?
Do you mind if I open the door,¬øTe importa si abro la puerta?
I'd be happy to help you.,Estar√≠a encantado de ayudarte.
I'm running late.,Voy con retraso.
I'll be there in 10 minutes.,Estar√© all√≠ en 10 minutos.
what are you up to today?,¬øQu√© est√°s haciendo hoy?
not much just relaxing at home.,No mucho, solo descansando en casa.
Let's catch up soon.,Pong√°monos al d√≠a pronto.
I'll get back to you,Me pondr√© en contacto contigo enseguida.
what do you mean?,¬øQu√© quieres decir?
let me think about it,D√©jame pensarlo
that makes sense.,Eso tiene sentido.
I don't no idea,No tengo ni idea
that's a good point.,Ese es un buen punto.
it was nice talking to you.,Fue agradable hablar contigo.
take care,Cu√≠date
see you around,Nos vemos
keep in touch,mantenerse en contacto
fairly well,bastante bien, ŸÜÿ≥ÿ®amente bien
at length my wish was realized.,Al final, mi deseo se hizo realidad.
that makes no sense at all.,Eso no tiene ning√∫n sentido.
I can't get the lid off.,No puedo quitar la tapa.
half a loaf is better than none.,Medio pan es mejor que nada.
you bet!,Apuesto a que s√≠!
jogging,correr
It's coming along,Est√° saliendo adelante
I got suntanned,Me bronce√©
Here you are! there you go! here you go!,¬°Aqu√≠ tienes!
let‚Äôs cut to the chase,Vamos al grano
trust,confianza
chase,perseguir
I'm quite impressed,Estoy bastante impresionado
don't be hard on yourself,no seas duro contigo mismo
come on in,entra
headshot,disparo a la cabeza
I gotta go,tengo que irme
crooked,torcido
let‚Äôs cut to the chase,Vamos al grano
upcoming,pr√≥ximo
chase,perseguir
trust,confianza
this is not up for discussion,esto no est√° en discusi√≥n
you ate fired,est√°s despedido
came on to her,se le acerc√≥ (rom√°nticamente)
something was off about her,algo estaba mal con ella
give birth,dar a luz
insecure,inseguro
actress,actriz
pretend,pretender
it turns out,resulta que
my head hurts,me duele la cabeza
I smell his Cologne,Puedo oler su colonia (masculino)
I smell her Cologne,Puedo oler su colonia (femenino)
cologne,colonia
can you believe this weather,¬øPuedes creer este clima?
looks like it might rain,Parece que podr√≠a llover
it drizzling a little bit,Est√° lloviendo un poco
hot and sticky,Caliente y pegajosa
breeze,brisa
the heat is getting to me,El calor me est√° afectando
the sky is clearing up,El cielo se est√° despejando
fate,destino
blessing,Bendici√≥n
embraced,abrazada
kneeling,de rodillas
stagnant,estancada
delighted,Encantada
you don‚Äôt get to judge me,No puedes juzgarme
you don‚Äôt get to tell me what to do,No tienes derecho a decirme qu√© hacer
you don‚Äôt get to lecture me,No tienes derecho a sermonearme
you don‚Äôt get to ignore me,No tienes derecho a ignorarme
you don‚Äôt get to question my choices,No tienes derecho a cuestionar mis decisiones
we are out of milk,Nosotros estamos sin leche
gas, petrol,gasolina
I‚Äôm out of cash,Estoy sin dinero
we ran out of milk this morning,Nos quedamos sin leche esta ma√±ana
we are out of augure,Estamos sin augurio
we ran out of sugar yesterday,Nos quedamos sin az√∫car ayer
my phone ran out of battery,Mi tel√©fono se qued√≥ sin bater√≠a
we are running out of time,Nos estamos quedando sin tiempo
Withered,Marchita (femenino) / Marchito (masculino)
baking soda,bicarbonato
pesticide,pesticida
strainer,colador
paper towel,toalla de papel
food container,contenedor de comida
crisp,crujiente
herb, parsley,hierba, perejil
green onion, lettuce,cebolla verde, lechuga
I'm getting tired of,me estoy cansando de
kick her out,echarla
I don‚Äôt believe this,no puedo creer esto
sweetheart,cari√±o
I was up late studying,Estuve despierto hasta tarde estudiando
cereal,cereal
that's disgusting,Eso es repugnante
stop trying to defend her,deja de intentar defenderla
I've had enough of this,Ya he tenido suficiente de esto
this is enough for debate, either she goes or I go,Esto es suficiente para debatir, o ella se va o yo me voy
it's either her or me,Es ella o yo
you always come first,Siempre eres prioridad
I can't believe you would choose her over me,No puedo creer que la elegir√≠as sobre m√≠
she is heartbroken,Ella est√° desconsolada
all of her stuff,todas sus cosas
things settled down,las cosas se calmaron
as time goes on,A medida que pasa el tiempo
she keeps getting upset at him,Ella sigue enoj√°ndose con √©l
don't argue and fight with him,no discutas ni pelees con √©l
pay someone a visit,hacerle una visita a alguien
we broke up,Nosotros rompimos
it turns out,resulta que
she kept having problem with everything,Ella segu√≠a teniendo problemas con todo
I should have chosen,Deber√≠a haber elegido
I should choose,Deber√≠a elegir
family always comes first,La familia siempre es prioridad
can you please forgive me?,¬øPuedes perdonarme, por favor?
I‚Äôm glad you realized that,Me alegra que te hayas dado cuenta de eso
move out,Salir de la casa
move in,Mudarse a una casa
the last of the milk,Lo √∫ltimo de la leche
I promise you,Te lo prometo
as long as,mientras
I would love that,Me encantar√≠a eso
bride and groom,Los novios
no big deal,No es gran cosa
everybody say cheese,Todos digan "queso"
Did you not hear me?,¬øNo me escuchaste?
she‚Äôs about to be my wife,Est√° a punto de ser mi esposa
Hello, I‚Äôd like to check in, please,Hola, quisiera hacer check in, por favor
Can you give me a room with a sea view?,¬øMe puede dar una habitaci√≥n con vista al mar?
Can I have a late check-out, please?,¬øPuedo hacer el check-out m√°s tarde, por favor?
Do you have a shuttle service to downtown?,¬øTienen servicio de transporte al centro?
Can I have a quieter room, please?,¬øPodr√≠a darme una habitaci√≥n m√°s tranquila, por favor?
Can I have an extra blanket/pillow?,¬øPodr√≠a darme una manta/almohada extra?
Do you have any available connecting rooms?,¬øTienen habitaciones comunicadas disponibles?
Can I have a crib or extra bed for my child?,¬øPodr√≠a tener una cuna o cama extra para mi hijo?
Can I have some recommendations for local attractions?,¬øPodr√≠a darme algunas recomendaciones de atracciones locales?
Do you have a gym or fitness center on-site?,¬øTienen un gimnasio o centro de fitness en el hotel?
Single Room,Habitaci√≥n individual
Double Room,Habitaci√≥n doble
Twin Room,Habitaci√≥n twin
Suite,Suite
Family Room,Habitaci√≥n familiar
Deluxe Room,Habitaci√≥n de lujo
Penthouse,√Åtico
Receptionist,Recepcionista
Concierge,Conserje
Housekeeping,Personal de limpieza
Bellboy,Botones
Manager,Gerente
Lobby,Vest√≠bulo
Front Desk,Recepci√≥n
Lounge,Sal√≥n
Gym,Gimnasio
Swimming Pool,Piscina
Business Center,Centro de negocios
Spa,Spa
Reservation,Reserva
Check-In,Registro de entrada
Check-Out,Salida
No-Show,No presentaci√≥n
Cancellation Policy,Pol√≠tica de cancelaci√≥n
Walk-In,Cliente sin reserva
Key Card,Tarjeta llave
Mini-Bar,Minibar
Air Conditioning,Aire acondicionado
Wi-Fi,Wi-Fi
En-Suite Bathroom,Ba√±o privado
Balcony,Balc√≥n
Room Rate,Tarifa de habitaci√≥n
Deposit,Dep√≥sito
Additional Charges,Cargos adicionales
Inclusive of Taxes,Impuestos incluidos
Exclusive of Taxes,Impuestos no incluidos
Credit Card Authorization,Autorizaci√≥n de tarjeta de cr√©dito
Room Service,Servicio a la habitaci√≥n
Laundry Service,Servicio de lavander√≠a
Shuttle Service,Servicio de traslado
Wake-Up Call,Llamada de despertador
Turndown Service,Servicio de preparaci√≥n de la habitaci√≥n
Overbooking,Sobreventa
Lost and Found,Objetos perdidos
Do Not Disturb (DND),No molestar
Complaint,Queja
All-Inclusive,Todo incluido
Bed and Breakfast (B&B),Alojamiento y desayuno
Hostel,Hostal
Cancellation Fee,Cargo por cancelaci√≥n
Early Check-In,Check-in temprano
Late Check-Out,Check-out tard√≠o
I brought plus one,Traje un acompa√±ante
how close you two were,Qu√© tan cerca estaban ustedes dos
it is gonna last,Va a durar
keep you options open,Mant√©n tus opciones abiertas
slump,Ca√≠da
avid,√Åvida
came up,Surgi√≥
I got up late,Me levant√© tarde
this is my least favorite chore,Esta es mi tarea menos favorita
I‚Äôm touched,Estoy conmovido
I‚Äôm scared,Estoy asustada
let‚Äôs get down to business,Vamos a ponernos manos a la obra
I‚Äôll leave it to your imagination,Lo dejo a tu imaginaci√≥n
is there a tennis court around here?,¬øHay una cancha de tenis por aqu√≠?
that's revolting!,¬°Eso es repugnante!
Can she have broken off with them?,¬øPuede ella haber roto con ellas?
maybe next time,Tal vez la pr√≥xima vez
are you sleepy?,¬øtienes sue√±o?
the wind is picking up,El viento est√° arreciando
I almost forgot,Casi lo olvido
it‚Äôs in English,Est√° en ingl√©s
this watch keeps correct time,Este reloj mantiene la hora correcta
the news makes us uneasy,La noticia nos inquieta
I would rather divorce him,Preferir√≠a divorciarme de √©l
you should carry out his offer,Deber√≠as llevar a cabo su oferta
I‚Äôll give it a try,Voy a intentarlo
nice meeting you,Un gusto conocerte
I don‚Äôt know which button to push,No s√© qu√© bot√≥n presionar
I‚Äôve put the past behind me,He dejado el pasado atr√°s
this is defective,esto es defectuoso
    `.trim();

    // --- CARD PARSING ---
    function parseCards(text) {
      return text.split('\n').map(line => {
        // Allow commas in back, so only first comma splits
        let [front, ...backArr] = line.split(',');
        let back = backArr.join(',').trim();
        return { front: front.trim(), back: back, id: Math.random().toString(36).slice(2,12) };
      }).filter(card => card.front && card.back);
    }

    // --- STORAGE: Load & Save ---
    function loadCards() {
      let data = localStorage.getItem(STORAGE_KEY_CARDS);
      if (!data) return parseCards(defaultCardsText);
      try {
        const arr = JSON.parse(data);
        return arr.map(card => ({
          front: card.front,
          back: card.back,
          id: card.id || Math.random().toString(36).slice(2,12)
        }));
      } catch { return parseCards(defaultCardsText); }
    }
    function saveCards(cards) {
      localStorage.setItem(STORAGE_KEY_CARDS, JSON.stringify(cards));
    }
    function loadStats(cards) {
      let data = localStorage.getItem(STORAGE_KEY_STATS);
      let stats = {};
      if (data) {
        try { stats = JSON.parse(data); } catch { stats = {}; }
      }
      for (let c of cards) {
        if (!stats[c.id]) stats[c.id] = { reviewed: 0, correct: 0, wrong: 0, difficult: false };
      }
      Object.keys(stats).forEach(cid=>{
        if (!cards.find(c=>c.id===cid)) delete stats[cid];
      });
      return stats;
    }
    function saveStats(stats) {
      localStorage.setItem(STORAGE_KEY_STATS, JSON.stringify(stats));
    }

    // --- STATE ---
    let cards = loadCards();
    let stats = loadStats(cards);
    let mode = 'all'; // 'all' or 'difficult'
    let current = 0;
    let flipped = false;
    let showEnglishFront = true;
    let shuffleMode = false;
    let appMode = 'flashcard'; // 'flashcard', 'quiz', 'matching'
    let quizState = null;
    let matchingState = null;

    // --- ELEMENTS ---
    const flashcardArea = document.getElementById('flashcard-area');
    const flashcard = document.getElementById('flashcard');
    const counter = document.getElementById('counter');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const flipBtn = document.getElementById('flip-btn');
    const easyBtn = document.getElementById('easy-btn');
    const hardBtn = document.getElementById('hard-btn');
    const importArea = document.getElementById('import');
    const importBtn = document.getElementById('import-btn');
    const resetBtn = document.getElementById('reset-btn');
    const statReviewed = document.getElementById('stat-reviewed');
    const statCorrect = document.getElementById('stat-correct');
    const statDifficult = document.getElementById('stat-difficult');
    const statMode = document.getElementById('stat-mode');
    const modeAllBtn = document.getElementById('mode-all');
    const modeDiffBtn = document.getElementById('mode-difficult');
    const progressReviewed = document.getElementById('progress-reviewed');
    const progressAccuracy = document.getElementById('progress-accuracy');
    const progressDifficult = document.getElementById('progress-difficult');
    const toggleLangBtn = document.getElementById('toggle-lang-btn');
    const shuffleBtn = document.getElementById('shuffle-btn');
    // Mode nav
    const flashcardModeBtn = document.getElementById('flashcard-mode-btn');
    const quizModeBtn = document.getElementById('quiz-mode-btn');
    const matchingModeBtn = document.getElementById('matching-mode-btn');
    // Quiz elements
    const quizArea = document.getElementById('quiz-area');
    const quizQuestion = document.getElementById('quiz-question');
    const quizInput = document.getElementById('quiz-input');
    const quizSubmitBtn = document.getElementById('quiz-submit-btn');
    const quizFeedback = document.getElementById('quiz-feedback');
    const quizProgress = document.getElementById('quiz-progress');
    const quizScore = document.getElementById('quiz-score');
    const quizExitBtn = document.getElementById('quiz-exit-btn');
    // Matching elements
    const matchingArea = document.getElementById('matching-area');
    const matchLeft = document.getElementById('match-left');
    const matchRight = document.getElementById('match-right');
    const matchingScore = document.getElementById('matching-score');
    const matchingEndMsg = document.getElementById('matching-end-message');
    const matchingExitBtn = document.getElementById('matching-exit-btn');

    // --- HELPERS ---
    function difficultList() {
      return cards.filter(card => stats[card.id]?.difficult);
    }
    function getCardList() {
      if (mode === 'all') return cards;
      return difficultList();
    }
    function cardsToText() {
      return cards.map(card => `${card.front},${card.back}`).join('\n');
    }
    function shuffleArray(array) {
      let arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
    function normalize(str) {
      return str.trim().toLowerCase().replace(/\s+/g, ' ');
    }
    // --- FLASHCARD LOGIC ---
    function showCard(idx) {
      if (appMode !== 'flashcard') return;
      let list = getCardList();
      if (list.length === 0) {
        flashcard.textContent = "No cards in this mode.";
        counter.textContent = '';
        return;
      }
      current = (idx + list.length) % list.length;
      flipped = false;
      flashcard.classList.remove('flipped');
      const card = list[current];
      flashcard.style.opacity = 0;
      setTimeout(() => {
        flashcard.textContent = showEnglishFront ? card.front : card.back;
        counter.textContent = `Card ${current + 1} of ${list.length}`;
        flashcard.classList.remove('flipped');
        flashcard.style.animation = "none";
        void flashcard.offsetWidth;
        flashcard.style.animation = null;
        flashcard.style.opacity = 1;
      }, 170);
    }
    function flipCard() {
      if (appMode !== 'flashcard') return;
      let list = getCardList();
      if (!list.length) return;
      flipped = !flipped;
      flashcard.classList.toggle('flipped', flipped);
      const card = list[current];
      flashcard.style.opacity = 0;
      setTimeout(() => {
        if (flipped) flashcard.textContent = showEnglishFront ? card.back : card.front;
        else flashcard.textContent = showEnglishFront ? card.front : card.back;
        flashcard.style.animation = "none";
        void flashcard.offsetWidth;
        flashcard.style.animation = null;
        flashcard.style.opacity = 1;
      }, 150);
    }
    function nextCard() {
      let list = getCardList();
      if (list.length === 0) return;
      if (shuffleMode) {
        let idx;
        do {
          idx = Math.floor(Math.random() * list.length);
        } while (list.length > 1 && idx === current);
        showCard(idx);
      } else {
        showCard(current + 1);
      }
    }
    function prevCard() {
      let list = getCardList();
      if (list.length === 0) return;
      if (shuffleMode) {
        let idx;
        do {
          idx = Math.floor(Math.random() * list.length);
        } while (list.length > 1 && idx === current);
        showCard(idx);
      } else {
        showCard(current - 1);
      }
    }
    function markEasy() {
      let list = getCardList();
      if (!list.length) return;
      let c = list[current];
      stats[c.id].reviewed += 1;
      stats[c.id].correct += 1;
      stats[c.id].difficult = false;
      saveStats(stats);
      updateStatsPanel();
      nextCard();
    }
    function markHard() {
      let list = getCardList();
      if (!list.length) return;
      let c = list[current];
      stats[c.id].reviewed += 1;
      stats[c.id].wrong += 1;
      stats[c.id].difficult = true;
      saveStats(stats);
      updateStatsPanel();
      nextCard();
    }
    // --- STATS PANEL ---
    function updateStatsPanel() {
      let total = cards.length;
      let reviewed = Object.values(stats).reduce((a, s) => a + s.reviewed, 0);
      let correct = Object.values(stats).reduce((a, s) => a + s.correct, 0);
      let wrong = Object.values(stats).reduce((a, s) => a + s.wrong, 0);
      let difficult = cards.filter(c => stats[c.id]?.difficult).length;
      let percent = reviewed === 0 ? 0 : Math.round(100 * correct / reviewed);
      statReviewed.textContent = reviewed;
      statCorrect.textContent = percent + '%';
      statDifficult.textContent = difficult;
      statMode.textContent = mode === 'all' ? 'All' : 'Difficult';
      modeAllBtn.classList.toggle('active', mode === 'all');
      modeDiffBtn.classList.toggle('active', mode === 'difficult');
      let reviewedPerc = total ? Math.min(100, Math.round((reviewed/total)*100)) : 0;
      progressReviewed.style.width = reviewedPerc + "%";
      progressAccuracy.style.width = percent + "%";
      let difficultPerc = total ? Math.min(100, Math.round((difficult/total)*100)) : 0;
      progressDifficult.style.width = difficultPerc + "%";
    }
    // --- MODE SWITCH ---
    function setMode(newMode) {
      mode = newMode;
      updateStatsPanel();
      showCard(0);
    }
    // --- APP MODE SWITCH (Flashcards/Quiz/Matching) ---
    function setAppMode(newMode) {
      appMode = newMode;
      // Mode nav highlight
      flashcardModeBtn.classList.toggle('active', appMode === 'flashcard');
      quizModeBtn.classList.toggle('active', appMode === 'quiz');
      matchingModeBtn.classList.toggle('active', appMode === 'matching');
      // Show/hide UI
      flashcardArea.style.display = appMode === 'flashcard' ? '' : 'none';
      quizArea.classList.toggle('active', appMode === 'quiz');
      matchingArea.classList.toggle('active', appMode === 'matching');
      if (appMode === 'flashcard') {
        showCard(current);
      } else if (appMode === 'quiz') {
        startQuiz();
      } else if (appMode === 'matching') {
        startMatching();
      }
    }
    // --- QUIZ GAME LOGIC ---
   let quizType = "mc"; // or "write"
    let quizPage = 0;
    let matchingPage = 0;
    const QUIZ_BATCH = 8;

    // Quiz type switching
    document.getElementById('quiz-type-mc').onclick = function() {
      quizType = "mc";
      this.classList.add("active");
      document.getElementById('quiz-type-write').classList.remove("active");
      startQuiz();
    };
    document.getElementById('quiz-type-write').onclick = function() {
      quizType = "write";
      this.classList.add("active");
      document.getElementById('quiz-type-mc').classList.remove("active");
      startQuiz();
    };

    // --- QUIZ GAME LOGIC (paging, MC & Write) ---
    function startQuiz() {
      let list = getCardList();
      if (list.length === 0) {
        quizArea.innerHTML = "<div style='color:#b44'>No cards in this mode.</div><button id='quiz-exit-btn2' class='mode-btn' style='margin-top:15px;'>Back to Flashcards</button>";
        document.getElementById('quiz-exit-btn2').onclick = () => setAppMode('flashcard');
        return;
      }
      // Only show a batch of 8 cards per quiz "page"
      quizPage = 0;
      quizState = {
        questions: [],
        index: 0,
        correct: 0,
        wrong: 0,
        answered: [],
      };
      makeQuizBatch();
    }
    function makeQuizBatch() {
      let list = shuffleArray(getCardList());
      let start = quizPage * QUIZ_BATCH;
      let end = Math.min(list.length, start + QUIZ_BATCH);
      quizState.questions = list.slice(start, end);
      quizState.index = 0;
      quizState.correct = 0;
      quizState.wrong = 0;
      quizState.answered = [];
      showQuizQuestion();
    }
    function showQuizQuestion() {
      const list = quizState.questions;
      const idx = quizState.index;
      document.getElementById("quiz-mc-list").style.display = quizType === "mc" ? "" : "none";
      quizInput.style.display = quizType === "write" ? "" : "none";
      quizSubmitBtn.style.display = quizType === "write" ? "" : "none";
      if (idx >= list.length) {
        quizQuestion.textContent = "Quiz Finished!";
        document.getElementById("quiz-mc-list").innerHTML = "";
        quizInput.style.display = "none";
        quizSubmitBtn.style.display = "none";
        quizProgress.textContent = "";
        quizScore.textContent = `Score: ${quizState.correct}/${list.length}`;
        quizFeedback.textContent = "";

        // Show Next 8 if more remain
        let allCards = getCardList();
        if ((quizPage+1)*QUIZ_BATCH < allCards.length) {
          quizScore.innerHTML += `<br><button id="quiz-next8-btn" class="mode-btn" style="margin-top:10px;">Next 8 &gt;</button>`;
          document.getElementById("quiz-next8-btn").onclick = () => { quizPage++; makeQuizBatch(); };
        }
        if (quizPage > 0) {
          quizScore.innerHTML += `<br><button id="quiz-prev8-btn" class="mode-btn" style="margin-top:10px;">&lt; Prev 8</button>`;
          document.getElementById("quiz-prev8-btn").onclick = () => { quizPage--; makeQuizBatch(); };
        }
        return;
      }
      quizFeedback.textContent = '';
      quizScore.textContent = '';
      quizProgress.textContent = `Question ${idx+1} of ${list.length}`;
      if (quizType === "write") {
        quizInput.value = '';
        quizInput.focus();
        quizQuestion.textContent = showEnglishFront ? list[idx].front : list[idx].back;
      } else {
        // Multiple choice
        let choices = [showEnglishFront ? list[idx].back : list[idx].front];
        let pool = getCardList()
          .filter(c=>c.id!==list[idx].id)
          .map(c=>showEnglishFront?c.back:c.front);
        shuffleArray(pool);
        while (choices.length < 4 && pool.length > 0) {
          let opt = pool.pop();
          if (!choices.includes(opt)) choices.push(opt);
        }
        shuffleArray(choices);
        quizQuestion.textContent = showEnglishFront ? list[idx].front : list[idx].back;
        let ul = document.getElementById("quiz-mc-list");
        ul.innerHTML = "";
        choices.forEach(choice => {
          let li = document.createElement("li");
          let btn = document.createElement("button");
          btn.textContent = choice;
          btn.className = "quiz-mc-btn";
          btn.onclick = function() {
            let correctAnswer = showEnglishFront ? list[idx].back : list[idx].front;
            if (normalize(choice) === normalize(correctAnswer)) {
              btn.classList.add("correct");
              quizFeedback.textContent = "Correct!";
              quizFeedback.className = "correct";
              quizState.correct++;
              stats[list[idx].id].reviewed++;
              stats[list[idx].id].correct++;
              stats[list[idx].id].difficult = false;
            } else {
              btn.classList.add("wrong");
              quizFeedback.textContent = `Wrong! Correct answer: ${correctAnswer}`;
              quizFeedback.className = "wrong";
              quizState.wrong++;
              stats[list[idx].id].reviewed++;
              stats[list[idx].id].wrong++;
              stats[list[idx].id].difficult = true;
            }
            saveStats(stats); updateStatsPanel();
            // Disable all buttons
            ul.querySelectorAll("button").forEach(b => {
              b.disabled = true; b.classList.add("disabled");
            });
            setTimeout(()=>{ quizState.index++; showQuizQuestion(); }, 1200);
          };
          li.appendChild(btn);
          ul.appendChild(li);
        });
      }
    }
    quizSubmitBtn.onclick = function() {
      const list = quizState.questions;
      const idx = quizState.index;
      const card = list[idx];
      let correctAnswer = showEnglishFront ? card.back : card.front;
      let userAns = quizInput.value;
      if (normalize(userAns) === normalize(correctAnswer)) {
        quizFeedback.textContent = "Correct!";
        quizFeedback.className = "correct";
        quizState.correct++;
        stats[card.id].reviewed++;
        stats[card.id].correct++;
        stats[card.id].difficult = false;
      } else {
        quizFeedback.textContent = `Wrong! Correct answer: ${correctAnswer}`;
        quizFeedback.className = "wrong";
        quizState.wrong++;
        stats[card.id].reviewed++;
        stats[card.id].wrong++;
        stats[card.id].difficult = true;
      }
      saveStats(stats); updateStatsPanel();
      quizState.index++;
      setTimeout(showQuizQuestion, 1100);
    };
    quizInput.onkeypress = function(e) { if (e.key === "Enter") quizSubmitBtn.onclick(); };
    quizExitBtn.onclick = function() { setAppMode('flashcard'); };

    // --- MATCHING GAME LOGIC (8 cards at a time) ---
    let matchingBatch = [];
    document.getElementById("matching-prev").onclick = function() {
      if (matchingPage > 0) { matchingPage--; startMatching(); }
    };
    document.getElementById("matching-next").onclick = function() {
      let all = getCardList();
      if ((matchingPage+1)*QUIZ_BATCH < all.length) { matchingPage++; startMatching(); }
    };
    function startMatching() {
      let list = shuffleArray(getCardList());
      matchingPage = Math.max(0, Math.min(matchingPage, Math.floor((list.length-1)/QUIZ_BATCH)));
      let start = matchingPage * QUIZ_BATCH;
      let end = Math.min(list.length, start + QUIZ_BATCH);
      matchingBatch = list.slice(start, end);
      let left = shuffleArray(matchingBatch.map(c=>({id:c.id, txt:showEnglishFront?c.front:c.back})));
      let right = shuffleArray(matchingBatch.map(c=>({id:c.id, txt:showEnglishFront?c.back:c.front})));
      matchingState = {
        left, right,
        leftSel: null,
        rightSel: null,
        matched: [],
        tries: 0,
        total: left.length,
        ended: false
      };
      matchingScore.textContent = `Score: 0/${left.length}`;
      matchingEndMsg.textContent = '';
      renderMatching();
    }
    function renderMatching() {
      matchLeft.innerHTML = '';
      matchRight.innerHTML = '';
      const st = matchingState;
      st.left.forEach((item, idx) => {
        let btn = document.createElement('button');
        btn.className = 'match-btn';
        if (st.leftSel === idx) btn.classList.add('selected');
        if (st.matched.includes(item.id)) btn.classList.add('matched');
        btn.textContent = item.txt;
        btn.disabled = st.matched.includes(item.id) || st.ended;
        btn.onclick = function() {
          st.leftSel = idx;
          st.rightSel = null;
          renderMatching();
        };
        matchLeft.appendChild(btn);
      });
      st.right.forEach((item, idx) => {
        let btn = document.createElement('button');
        btn.className = 'match-btn';
        if (st.rightSel === idx) btn.classList.add('selected');
        if (st.matched.includes(item.id)) btn.classList.add('matched');
        btn.textContent = item.txt;
        btn.disabled = st.matched.includes(item.id) || st.ended;
        btn.onclick = function() {
          if (st.leftSel === null || st.matched.includes(item.id)) return;
          st.rightSel = idx;
          let leftID = st.left[st.leftSel].id, rightID = item.id;
          if (leftID === rightID) {
            st.matched.push(leftID);
            matchingScore.textContent = `Score: ${st.matched.length}/${st.total}`;
            st.leftSel = null;
            st.rightSel = null;
            if (st.matched.length === st.total) {
              st.ended = true;
              matchingEndMsg.textContent = "Game finished! Well done!";
            }
            renderMatching();
          } else {
            stats[leftID].difficult = true; stats[item.id].difficult = true;
            stats[leftID].wrong = (stats[leftID].wrong||0)+1;
            stats[item.id].wrong = (stats[item.id].wrong||0)+1;
            saveStats(stats); updateStatsPanel();
            let leftBtns = matchLeft.querySelectorAll('.match-btn');
            let rightBtns = matchRight.querySelectorAll('.match-btn');
            leftBtns[st.leftSel].classList.add('incorrect');
            rightBtns[idx].classList.add('incorrect');
            setTimeout(()=>{
              leftBtns[st.leftSel].classList.remove('incorrect');
              rightBtns[idx].classList.remove('incorrect');
              st.leftSel = null; st.rightSel = null;
              renderMatching();
            }, 600);
          }
        };
        matchRight.appendChild(btn);
      });
    }
    matchingExitBtn.onclick = function() { setAppMode('flashcard'); };

    // --- UI EVENTS as before ---
    modeAllBtn.onclick = () => { mode = 'all'; updateStatsPanel(); showCard(0); };
    modeDiffBtn.onclick = () => { mode = 'difficult'; updateStatsPanel(); showCard(0); };
    prevBtn.onclick = prevCard;
    nextBtn.onclick = nextCard;
    flipBtn.onclick = flipCard;
    flashcard.onclick = flipCard;
    flashcard.onkeypress = (e) => { if (e.key === ' ' || e.key === 'Enter') flipCard(); };
    easyBtn.onclick = markEasy;
    hardBtn.onclick = markHard;
    toggleLangBtn.onclick = () => {
      showEnglishFront = !showEnglishFront;
      toggleLangBtn.textContent = showEnglishFront ? "Show English ‚Üí Spanish" : "Show Spanish ‚Üí English";
      if (appMode === 'flashcard') showCard(current);
      if (appMode === 'quiz') startQuiz();
      if (appMode === 'matching') startMatching();
    };
    shuffleBtn.onclick = () => {
      shuffleMode = !shuffleMode;
      shuffleBtn.classList.toggle('active', shuffleMode);
      shuffleBtn.textContent = shuffleMode ? "Random Mode ON" : "Shuffle / Random Mode";
    };
    importBtn.onclick = () => {
      const newCards = parseCards(importArea.value);
      if (newCards.length) {
        cards = newCards.map(c => ({ ...c, id: Math.random().toString(36).slice(2,12) }));
        saveCards(cards);
        stats = loadStats(cards);
        saveStats(stats);
        mode = 'all';
        updateStatsPanel();
        showCard(0);
        alert(`Imported ${cards.length} cards!`);
      } else {
        alert("No valid cards found. Please check your format.");
      }
    };
    resetBtn.onclick = () => {
      if (confirm("Are you sure you want to reset to the default cards? All current cards will be replaced.")) {
        cards = parseCards(defaultCardsText);
        saveCards(cards);
        stats = loadStats(cards);
        saveStats(stats);
        mode = 'all';
        updateStatsPanel();
        showCard(0);
        importArea.value = cardsToText();
        alert("Reset to default cards!");
      }
    };
    flashcardModeBtn.onclick = () => setAppMode('flashcard');
    quizModeBtn.onclick = () => setAppMode('quiz');
    matchingModeBtn.onclick = () => setAppMode('matching');
    importArea.value = cardsToText();
    updateStatsPanel();
    setAppMode('flashcard');
  </script>
</body>
</html>
